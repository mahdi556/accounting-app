// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// ==========================================================
// Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ø§ØµÙ„ÛŒ
// ==========================================================

// Û±. Ø­Ø³Ø§Ø¨ Ú©Ù„ (AccountCategory)
model AccountCategory {
  id            Int               @id @default(autoincrement())
  code          String            @unique @db.VarChar(10)
  name          String            @db.VarChar(100)
  type          AccountType       // Ø¯Ø§Ø±Ø§ÛŒÛŒØŒ Ø¨Ø¯Ù‡ÛŒØŒ Ø³Ø±Ù…Ø§ÛŒÙ‡ØŒ Ø¯Ø±Ø¢Ù…Ø¯ØŒ Ù‡Ø²ÛŒÙ†Ù‡
  parentId      Int?
  parent        AccountCategory?  @relation("CategoryParent", fields: [parentId], references: [id])
  children      AccountCategory[] @relation("CategoryParent")
  subAccounts   SubAccount[]
  createdAt     DateTime          @default(now())
  
  @@map("account_categories")
}

// Û². Ø­Ø³Ø§Ø¨ Ù…Ø¹ÛŒÙ† (SubAccount)
model SubAccount {
  id             Int             @id @default(autoincrement())
  code           String          @unique @db.VarChar(15)
  name           String          @db.VarChar(100)
  categoryId     Int
  category       AccountCategory @relation(fields: [categoryId], references: [id])
  balance        Float           @default(0)
  
  detailAccounts DetailAccount[]
  voucherItems   VoucherItem[]
  
  // Ø±ÙˆØ§Ø¨Ø· Ú†Ú©â€ŒÙ‡Ø§
  drawerCheques  Cheque[]        @relation("ChequeDrawer")  // Ú†Ú© Ø¯Ø±ÛŒØ§ÙØªÙ†ÛŒ Ø§Ø² Ø§ÛŒÙ† Ø­Ø³Ø§Ø¨ ØµØ§Ø¯Ø± Ø´Ø¯Ù‡ Ø§Ø³Øª
  payeeCheques   Cheque[]        @relation("ChequePayee")   // Ú†Ú© Ù¾Ø±Ø¯Ø§Ø®ØªÙ†ÛŒ Ø¨Ù‡ Ø§ÛŒÙ† Ø­Ø³Ø§Ø¨ Ø¯Ø§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª
  
  createdAt      DateTime        @default(now())
  
  @@map("sub_accounts")
}

// Û³. Ø­Ø³Ø§Ø¨ ØªÙØµÛŒÙ„ÛŒ (DetailAccount)
model DetailAccount {
  id                Int             @id @default(autoincrement())
  code              String          @unique @db.VarChar(20)
  name              String          @db.VarChar(100)
  subAccountId      Int
  subAccount        SubAccount      @relation(fields: [subAccountId], references: [id])
  balance           Float           @default(0)
  
  // Ø§Ø±ØªØ¨Ø§Ø· ÛŒÚ© Ø¨Ù‡ ÛŒÚ© Ø¨Ø§ Person
  person            Person?
  
  // Ø±ÙˆØ§Ø¨Ø· Ú†Ú©â€ŒÙ‡Ø§
  drawerCheques     Cheque[]        @relation("ChequeDrawerDetail")  // ØªÙØµÛŒÙ„ÛŒ ØµØ§Ø¯Ø±Ú©Ù†Ù†Ø¯Ù‡
  payeeCheques      Cheque[]        @relation("ChequePayeeDetail")   // ØªÙØµÛŒÙ„ÛŒ Ú¯ÛŒØ±Ù†Ø¯Ù‡
  
  // ğŸ¯ Ø±ÙˆØ§Ø¨Ø· Ø¬Ø¯ÛŒØ¯ Ù…ÙˆØ±Ø¯ Ù†ÛŒØ§Ø² Ø¨Ø±Ø§ÛŒ Ú†Ú©
  expenseCheques    Cheque[]        @relation("ChequeExpenseDetail") // ØªÙØµÛŒÙ„ÛŒ Ù‡Ø²ÛŒÙ†Ù‡/Ø®Ø±ÛŒØ¯
  bankCheques       Cheque[]        @relation("ChequeBankDetail")    // ØªÙØµÛŒÙ„ÛŒ Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú©
  
  voucherItems      VoucherItem[]
  createdAt         DateTime        @default(now())
  
  @@map("detail_accounts")
}

// Û´. Ø´Ø®Øµ (Ø·Ø±Ù Ø­Ø³Ø§Ø¨)
model Person {
  id                Int              @id @default(autoincrement())
  name              String           @db.VarChar(100)
  type              PersonType       // Ù…Ø´ØªØ±ÛŒØŒ ØªØ§Ù…ÛŒÙ† Ú©Ù†Ù†Ø¯Ù‡ØŒ Ú©Ø§Ø±Ù…Ù†Ø¯
  phone             String?          @db.VarChar(20)
  email             String?          @db.VarChar(100)
  address           String?
  
  // Ø§Ø±ØªØ¨Ø§Ø· ÛŒÚ© Ø¨Ù‡ ÛŒÚ© Ø¨Ø§ DetailAccount (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  detailAccountId   Int?             @unique
  detailAccount     DetailAccount?   @relation(fields: [detailAccountId], references: [id], onDelete: SetNull)
  
  voucherItems      VoucherItem[]
  cheques           Cheque[]
  createdAt         DateTime         @default(now())
  
  @@map("persons")
}

// Ûµ. Ø³Ù†Ø¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ (Voucher)
model Voucher {
  id            Int           @id @default(autoincrement())
  voucherNumber String        @unique @db.VarChar(20)
  voucherDate   DateTime
  description   String?
  totalAmount   Float
  createdBy     Int?          // User ID
  items         VoucherItem[]
  cheques       Cheque[]
  createdAt     DateTime      @default(now())
  
  @@map("vouchers")
}

// Û¶. Ø±Ø¯ÛŒÙ Ø³Ù†Ø¯ (VoucherItem)
model VoucherItem {
  id                Int            @id @default(autoincrement())
  voucherId         Int
  voucher           Voucher        @relation(fields: [voucherId], references: [id], onDelete: Cascade)
  subAccountId      Int?
  subAccount        SubAccount?    @relation(fields: [subAccountId], references: [id])
  detailAccountId   Int?
  detailAccount     DetailAccount? @relation(fields: [detailAccountId], references: [id])
  personId          Int?
  person            Person?        @relation(fields: [personId], references: [id])
  description       String?
  debit             Float          @default(0)
  credit            Float          @default(0)
  
  @@map("voucher_items")
}

// Û·. Ú†Ú© (Cheque)
model Cheque {
  id                     Int             @id @default(autoincrement())
  chequeNumber           String          @db.VarChar(50)
  bankName               String          @db.VarChar(100)
  branchName             String?         @db.VarChar(100)
  amount                 Float
  issueDate              DateTime
  dueDate                DateTime
  drawer                 String          @db.VarChar(100) // Ù†Ø§Ù… ØµØ§Ø¯Ø±Ú©Ù†Ù†Ø¯Ù‡
  payee                  String?         @db.VarChar(100)  // Ù†Ø§Ù… Ú¯ÛŒØ±Ù†Ø¯Ù‡
  type                   ChequeType      // Ø¯Ø±ÛŒØ§ÙØªÙ†ÛŒ ÛŒØ§ Ù¾Ø±Ø¯Ø§Ø®ØªÙ†ÛŒ
  status                 ChequeStatus    @default(pending)
  description            String?
  issueReason            String?         @db.VarChar(20) // 'settlement' ÛŒØ§ 'expense'

  // Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ Ù…Ø¹ÛŒÙ† Ù…Ø±ØªØ¨Ø· (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  drawerAccountId        Int?
  drawerAccount          SubAccount?     @relation("ChequeDrawer", fields: [drawerAccountId], references: [id], onDelete: SetNull)
  
  payeeAccountId         Int?
  payeeAccount           SubAccount?     @relation("ChequePayee", fields: [payeeAccountId], references: [id], onDelete: SetNull)

  // Ø­Ø³Ø§Ø¨â€ŒÙ‡Ø§ÛŒ ØªÙØµÛŒÙ„ÛŒ Ù…Ø±ØªØ¨Ø· (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)
  drawerDetailAccountId  Int?
  drawerDetailAccount    DetailAccount?  @relation("ChequeDrawerDetail", fields: [drawerDetailAccountId], references: [id], onDelete: SetNull)
  
  payeeDetailAccountId   Int?
  payeeDetailAccount     DetailAccount?  @relation("ChequePayeeDetail", fields: [payeeDetailAccountId], references: [id], onDelete: SetNull)
  
  // ğŸ¯ Ø±ÙˆØ§Ø¨Ø· ØªÙØµÛŒÙ„ÛŒ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ù†Ø·Ù‚ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ
  bankDetailAccountId    Int?
  bankDetailAccount      DetailAccount?  @relation("ChequeBankDetail", fields: [bankDetailAccountId], references: [id], onDelete: SetNull) // Ø­Ø³Ø§Ø¨ Ø¨Ø§Ù†Ú© Ø¨Ø±Ø§ÛŒ Ù¾ÛŒÚ¯ÛŒØ±ÛŒ ÙˆØµÙˆÙ„
  
  expenseDetailAccountId Int?
  expenseDetailAccount   DetailAccount?  @relation("ChequeExpenseDetail", fields: [expenseDetailAccountId], references: [id], onDelete: SetNull) // Ø­Ø³Ø§Ø¨ Ù‡Ø²ÛŒÙ†Ù‡/Ø®Ø±ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ø³Ù†Ø¯ Û´ Ø±Ø¯ÛŒÙÛŒ

  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø´Ø®Øµ (ØµØ§Ø¯Ø±Ú©Ù†Ù†Ø¯Ù‡/Ú¯ÛŒØ±Ù†Ø¯Ù‡ Ø§ØµÙ„ÛŒ Ø§Ø² Ù„ÛŒØ³Øª Ø§Ø´Ø®Ø§Øµ)
  personId               Int?
  person                 Person?         @relation(fields: [personId], references: [id], onDelete: Cascade)
  
  // Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø³Ù†Ø¯ Ø­Ø³Ø§Ø¨Ø¯Ø§Ø±ÛŒ
  voucherId              Int?
  voucher                Voucher?        @relation(fields: [voucherId], references: [id], onDelete: Cascade)
  
  createdAt              DateTime        @default(now())
  updatedAt              DateTime        @updatedAt

  @@unique([chequeNumber, type]) // Ø´Ù…Ø§Ø±Ù‡ Ú†Ú© Ùˆ Ù†ÙˆØ¹ Ø¢Ù† Ø¨Ø§ Ù‡Ù… ÛŒÚ©ØªØ§ Ù‡Ø³ØªÙ†Ø¯
  @@map("cheques")
}

// Û¸. Ø¨Ø§Ù†Ú© (Bank) - ØµØ±ÙØ§Ù‹ Ø¨Ø±Ø§ÛŒ Ù†Ú¯Ù‡Ø¯Ø§Ø±ÛŒ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ù„ÛŒ Ø¨Ø§Ù†Ú©â€ŒÙ‡Ø§
model Bank {
  id              Int       @id @default(autoincrement())
  name            String    @db.VarChar(100)
  accountNumber   String?   @db.VarChar(50)
  balance         Float     @default(0)
  createdAt       DateTime  @default(now())
  
  @@map("banks")
}

// ==========================================================
// EnumÙ‡Ø§
// ==========================================================

enum AccountType {
  asset     // Ø¯Ø§Ø±Ø§ÛŒÛŒ
  liability // Ø¨Ø¯Ù‡ÛŒ
  equity    // Ø³Ø±Ù…Ø§ÛŒÙ‡
  income    // Ø¯Ø±Ø¢Ù…Ø¯
  expense   // Ù‡Ø²ÛŒÙ†Ù‡
}

enum PersonType {
  customer  // Ù…Ø´ØªØ±ÛŒ
  supplier  // ØªØ§Ù…ÛŒÙ† Ú©Ù†Ù†Ø¯Ù‡
  employee  // Ú©Ø§Ø±Ù…Ù†Ø¯
}

enum ChequeType {
  receivable // Ø¯Ø±ÛŒØ§ÙØªÙ†ÛŒ
  payable    // Ù¾Ø±Ø¯Ø§Ø®ØªÙ†ÛŒ
}

enum ChequeStatus {
  pending   // Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±
  collected // ÙˆØµÙˆÙ„ Ø´Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ Ø¯Ø±ÛŒØ§ÙØªÙ†ÛŒ) ÛŒØ§ Ù¾Ø§Ø³ Ø´Ø¯Ù‡ (Ø¨Ø±Ø§ÛŒ Ù¾Ø±Ø¯Ø§Ø®ØªÙ†ÛŒ)
  deposited // Ø¯Ø± Ø¬Ø±ÛŒØ§Ù† ÙˆØµÙˆÙ„
  returned  // Ø¨Ø±Ú¯Ø´Øª Ø®ÙˆØ±Ø¯Ù‡
  canceled  // Ø¨Ø§Ø·Ù„ Ø´Ø¯Ù‡
}